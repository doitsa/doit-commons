machine:
  java:
    version: oraclejdk8

checkout:
  post:
    - rm -rf target
    - mkdir target
    - wget -O target/settings.xml "https://s3.amazonaws.com/www.doit.com.br/continuous-integration/NsaxdhByNmpHPjuy6uuZCytE4pT5czRqWPUq5TWgyCnwZygsySYPRbWk4r7msCjx.xml"

dependencies:
  override:
    - mvn dependency:go-offline dependency:resolve-plugins -B -s target/settings.xml -DskipTests

test:
  override:
    - mvn test -B -s target/settings.xml
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

deployment:
  main:
    branch: /.*/
    commands:
      - mvn deploy -B -s target/settings.xml -DskipTests
